const moduloJuego = (() => {
  let e = [];
  const t = ['C', 'D', 'H', 'S'],
    a = ['A', 'J', 'K', 'Q'];
  let o;
  const n = document.querySelectorAll('small'),
    r = document.querySelectorAll('.divCartas'),
    l = document.querySelector('#btnNuevo'),
    s = document.querySelector('#btnPedir'),
    c = document.querySelector('#btnDetener'),
    d = (t = 2) => {
      (e = u()), (o = []);
      for (let e = 0; e < t; e++) o.push(0);
      n.forEach((e) => (e.innerText = 0)), r.forEach((e) => (e.innerHTML = '')), (s.disabled = !1), (c.disabled = !1);
    },
    u = () => {
      for (e = [], i = 2; i <= 10; i++) for (tipo of t) e.push(i + tipo);
      for (especial of a) for (tipo of t) e.push(especial + tipo);
      return _.shuffle(e);
    },
    p = () => {
      if (0 === e.length) throw 'No hay cartas en la baraja';
      return e.pop();
    },
    m = (e, t) => (
      (o[t] =
        o[t] +
        ((e) => {
          const t = e.substring(0, e.length - 1);
          return isNaN(t) ? ('A' === t ? 11 : 10) : 1 * t;
        })(e)),
      (n[t].innerText = o[t]),
      o[t]
    ),
    b = (e, t) => {
      const a = document.createElement('img');
      a.classList.add('carta'), (a.src = `assets/cartas/${e}.png`), (a.alt = ''), r[t].append(a);
    },
    f = (e) => {
      let t = 0;
      do {
        const a = p();
        if (((t = m(a, o.length - 1)), b(a, o.length - 1), e > 21)) break;
      } while (t < e && e <= 21);
      (() => {
        const [e, t] = o;
        setTimeout(() => {
          t === e
            ? alert('Empate ðŸ’† ')
            : e > 21
            ? alert('Gana computadora ðŸ’» ')
            : t > 21
            ? alert('Jugador gana ðŸ™‹ ')
            : alert('Gana computadora ðŸ’» ');
        }, 30);
      })();
    };
  return (
    s.addEventListener('click', () => {
      const e = p(),
        t = m(e, 0);
      b(e, 0),
        t > 21
          ? (console.warn('Lo siento mucho, perdiste ðŸ˜” '), (s.disabled = !0), (c.disabled = !0), f(t))
          : 21 === t && (console.warn('21, genial '), (s.disabled = !0), (c.disabled = !0), f(t));
    }),
    c.addEventListener('click', () => {
      (s.disabled = !0), (c.disabled = !0), f(o[0]);
    }),
    l.addEventListener('click', () => {
      d();
    }),
    { nuevoJuego: d }
  );
})();
